(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[270],{3905:function(e,t,n){"use strict";n.d(t,{Zo:function(){return u},kt:function(){return m}});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var c=a.createContext({}),s=function(e){var t=a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},u=function(e){var t=s(e.components);return a.createElement(c.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,c=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),d=s(n),m=r,f=d["".concat(c,".").concat(m)]||d[m]||p[m]||i;return n?a.createElement(f,l(l({ref:t},u),{},{components:n})):a.createElement(f,l({ref:t},u))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,l=new Array(i);l[0]=d;var o={};for(var c in t)hasOwnProperty.call(t,c)&&(o[c]=t[c]);o.originalType=e,o.mdxType="string"==typeof e?e:r,l[1]=o;for(var s=2;s<i;s++)l[s]=n[s];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},4044:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return l},metadata:function(){return o},toc:function(){return c},default:function(){return u}});var a=n(2122),r=n(9756),i=(n(7294),n(3905)),l={id:"ability-file",title:"Ability file",sidebar_label:"Ability file",slug:"/ability-file"},o={unversionedId:"ability-file",id:"ability-file",isDocsHomePage:!1,title:"Ability file",description:"This file is the main entrypoint for your rules, it will instantiate Guard and assign the specified types.",source:"@site/docs/ability-file.md",sourceDirName:".",slug:"/ability-file",permalink:"/blitz-guard/docs/ability-file",editUrl:"https://github.com/ntgussoni/blitz-guard/edit/main/docs/docs/ability-file.md",version:"current",sidebar_label:"Ability file",frontMatter:{id:"ability-file",title:"Ability file",sidebar_label:"Ability file",slug:"/ability-file"},sidebar:"someSidebar",previous:{title:"Installation",permalink:"/blitz-guard/docs/installation"},next:{title:"Abilities",permalink:"/blitz-guard/docs/abilities"}},c=[{value:"Rules",id:"rules",children:[{value:"Best practices",id:"best-practices",children:[]}]},{value:"Can &amp; Cannot",id:"can--cannot",children:[]},{value:"Reasons",id:"reasons",children:[]}],s={toc:c};function u(e){var t=e.components,n=(0,r.Z)(e,["components"]);return(0,i.kt)("wrapper",(0,a.Z)({},s,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"This file is the main entrypoint for your rules, it will instantiate Guard and assign the specified types."),(0,i.kt)("p",null,"See: ",(0,i.kt)("inlineCode",{parentName:"p"},"app/guard/ability.ts")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},'import db, { Prisma } from "db"\nimport { GuardBuilder } from "@blitz-guard/core"\n\ntype ExtendedResourceTypes = "comment" | "article" | Prisma.ModelName\ntype ExtendedAbilityTypes = "send email"\n\nconst Guard = GuardBuilder<ExtendedResourceTypes, ExtendedAbilityTypes>(\n  async (ctx, { can, cannot }) => {\n    cannot("manage", "all") // See "Best practices" section\n\n    can("read", "article")\n    can("read", "comment")\n\n    if (ctx.session.$isAuthorized()) {\n      can("create", "article")\n      can("create", "comment")\n      can("send email", "comment")\n\n      can("delete", "comment", async (_args) => {\n        return (await db.comment.count({ where: { userId: ctx.session.userId } })) === 1\n      })\n    }\n  },\n)\n\nexport default Guard\n')),(0,i.kt)("h2",{id:"rules"},"Rules"),(0,i.kt)("p",null,"The ability file is read top to bottom, the bottom rules take more precedence that the ones at the top."),(0,i.kt)("p",null,"Take the following example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},'...\n\nconst Guard = GuardBuilder(\n    cannot(\'manage\', \'all\')\n\n    can("create", "article")\n    cannot("create", "article")\n)\n\nGuard.can("create", "article",{},{}) // false\n\n')),(0,i.kt)("h3",{id:"best-practices"},"Best practices"),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"Remove all permissions, give them one by one.")),(0,i.kt)("p",null,"Your logic will be more direct and easier to follow, this reduces confusion and potential bugs."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},'cannot("manage", "all") // This removes all abilities for all resources\n\ncan("create", "article")\n\nif (some_condition()) {\n  can("delete", "article")\n}\n')),(0,i.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Blitz Guard will allow everything unless you state otherwise. No rules means that everything is allowed."))),(0,i.kt)("br",null),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"if guards look similar, take some code out of them")),(0,i.kt)("p",null,"Guard will execute the guard condition if the rule matches the ability and resource.\nThis means that you should, whenever possible, take as much logic out of the rule's guard."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},'// Wrong \u274c\ncan("delete", "article", (ctx) => someHeavyMethod() === true)\ncan("update", "article", (ctx) => someHeavyMethod() === true)\n')),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},'// Right \u2705\nif (someHeavyMethod() === true) {\n  can("delete", "article")\n  can("update", "article")\n}\n')),(0,i.kt)("h2",{id:"can--cannot"},"Can & Cannot"),(0,i.kt)("p",null,"These two methods will determine what a user can or cannot do in your application."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"can(ability, resource, guard)\ncannot(ability, resource, guard)\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"ability"),(0,i.kt)("br",null),"\nThe action that the user can perform.",(0,i.kt)("br",null),"\nDefault: ",(0,i.kt)("inlineCode",{parentName:"p"},"create, read, update, delete, manage")," ",(0,i.kt)("br",null),"\n",(0,i.kt)("a",{parentName:"p",href:"abilities"},"More information"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"resource"),(0,i.kt)("br",null),"\nThe subject of the action.",(0,i.kt)("br",null),"\nDefault: ",(0,i.kt)("inlineCode",{parentName:"p"},"all"),(0,i.kt)("br",null),"\n",(0,i.kt)("a",{parentName:"p",href:"resources"},"More information"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"guard")," (",(0,i.kt)("em",{parentName:"p"},"optional"),"):",(0,i.kt)("br",null),"\nIt's the condition for the rule to apply, ",(0,i.kt)("em",{parentName:"p"},"args")," are passed down from a wrapped mutation or query or manually when calling ",(0,i.kt)("a",{parentName:"p",href:"https://ntgussoni.github.io/blitz-guard/docs/secure-your-endpoints#check-rules-inside-a-querymutation"},"Guard.can"),(0,i.kt)("br",null),"\n",(0,i.kt)("inlineCode",{parentName:"p"},"async (args) => boolean")))),(0,i.kt)("h2",{id:"reasons"},"Reasons"),(0,i.kt)("p",null,"With each rule, you can define a reason for it."),(0,i.kt)("p",null,"The text will be used in replacement of the ",(0,i.kt)("inlineCode",{parentName:"p"},"AuthorizationError")," message for both the ",(0,i.kt)("a",{parentName:"p",href:"/blitz-guard/docs/secure-your-endpoints#guardauthorizepipe"},"authorizePipe")," and ",(0,i.kt)("a",{parentName:"p",href:"/blitz-guard/docs/secure-your-endpoints#guardauthorize"},"authorize")),(0,i.kt)("p",null,"While using ",(0,i.kt)("a",{parentName:"p",href:"/blitz-guard/docs/secure-your-endpoints#check-rules-inside-a-querymutation"},"Guard.can")," you will receive the result, true/false and the reason."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},'...\n\nconst Guard = GuardBuilder(\n    cannot(\'manage\', \'all\')\n\n    can("create", "article")\n    cannot("create", "article").reason("Because I say so")\n)\n\nconst { can, reason } = Guard.can("create", "article",{},{})\nconsole.log(can) // false\nconsole.log(reason) // "Because I say so"\n')))}u.isMDXComponent=!0}}]);